<!DOCTYPE html>
<html lang="en-us">

<head>
  <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">

  <title>zsv playground</title>

  <script src="https://cdn.jsdelivr.net/npm/jquery"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery.terminal/js/jquery.terminal.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jquery.terminal/css/jquery.terminal.min.css" />

  <script type="text/javascript">
    var Module = {
      print: (function () {
        return (...args) => {
          const output = args.join(' ');
          $('body').terminal().echo(output);
        };
      })(),
      printErr: (function () {
        return (...args) => {
          const output = args.join(' ');
          $('body').terminal().error(output);
        };
      })()
    };

    Module['onRuntimeInitialized'] = function () {
      Module.FS.mkdir('/home/zsv');
      Module.FS.chdir('/home/zsv');
      Module.FS.writeFile('test.csv', 'a,b,c\n1,2,3\n4,5,6\n7,8,9');
    }
  </script>
</head>

<body>
  <script type="text/javascript">
    // Logo generated from:
    // https://patorjk.com/software/taag/#p=display&f=Doom&t=zsv%20playground
    // Replaced backticks with single quotes
    const logo = String.raw`
                       _                                             _ 
Welcome to            | |                                           | |
 _________   __  _ __ | | __ _ _   _  __ _ _ __ ___  _   _ _ __   __| |
|_  / __\ \ / / | '_ \| |/ _' | | | |/ _' | '__/ _ \| | | | '_ \ / _' |
 / /\__ \\ V /  | |_) | | (_| | |_| | (_| | | | (_) | |_| | | | | (_| |
/___|___/ \_/   | .__/|_|\__,_|\__, |\__, |_|  \___/ \__,_|_| |_|\__,_|
                | |             __/ | __/ |                            
                |_|            |___/ |___/                          :-)
`;
    const greetings = logo +
      "\n" +
      "Version: __VERSION__\n" +
      "GitHub repository: https://github.com/liquidaty/zsv\n" +
      "Report any issues here: https://github.com/liquidaty/zsv/issues\n" +
      "\n" +
      "To get started, run `zsv help`.\n" +
      "Supported commands are: `zsv`, `clear`, and `ls`\n"
      ;

    function ls() {
      const listing = Module.FS.readdir('.');
      const filtered = listing.filter((entry) => (entry !== '.' && entry !== '..'));
      $('body').terminal().echo(filtered);
    }

    $('body').terminal(function (command) {
      const parsed_command = $.terminal.parse_command(command);
      const name = parsed_command.name;
      const args = parsed_command.args;
      switch (name) {
        case 'help':
          this.error('TODO: List all available commands');
          break;

        case 'zsv':
          Module.callMain(args);
          break;

        case 'ls':
          ls();
          break;

        default:
          const msg =
            "Unsupported command! [" + name + "]\n" +
            "Supported commands are: `zsv`, `clear`, and `ls`";
          this.error(msg);
          break;
      }
    }, {
      checkArity: false,
      greetings: greetings,
      prompt: "[[;lightgreen;]zsv@playground$ ]"
    });
  </script>

  <script async type="text/javascript" src="cli.em.js"></script>
</body>

</html>
